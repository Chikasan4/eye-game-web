<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å‹•ä½“è¦–åŠ›ãƒˆãƒ¬ V6 (Badminton)</title>
    <style>
        body {
            margin: 0; overflow: hidden; background-color: #2E8B57; /* ã‚³ãƒ¼ãƒˆã®ç·‘è‰² */
            font-family: sans-serif; color: white; touch-action: none;
        }
        #game-container { display: none; width: 100%; height: 100%; }
        canvas { display: block; }
        
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; padding: 20px; box-sizing: border-box;
            display: flex; justify-content: space-between;
        }
        .hud { font-size: 18px; font-weight: bold; text-shadow: 1px 1px 2px black; }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ */
        #menu-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.9); display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 100;
        }
        h1 { margin-bottom: 10px; font-size: 24px; text-align: center; color: #fff; }
        
        .btn {
            width: 80%; max-width: 300px; padding: 15px; margin: 8px;
            font-size: 18px; font-weight: bold; color: #333;
            background-color: #fff; border: 3px solid #fff;
            border-radius: 30px; cursor: pointer; text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .btn:active { transform: scale(0.95); background-color: #ddd; }
        
        /* è¨­å®šã‚¨ãƒªã‚¢ */
        .setting-box {
            width: 80%; max-width: 300px;
            background-color: #444; padding: 15px; margin: 15px 0;
            border-radius: 10px; text-align: center; color: white;
        }
        input[type=range] { width: 100%; margin-top: 10px; accent-color: #00FF7F; }
        
        #result-screen {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.85); flex-direction: column;
            align-items: center; justify-content: center; z-index: 50;
        }
        #result-msg { font-size: 32px; margin-bottom: 20px; text-align: center; }
    </style>
</head>
<body>

    <div id="menu-screen">
        <h1>Badminton Trainer<br>V6</h1>
        
        <div class="setting-box">
            <label>çƒé€Ÿãƒ¬ãƒ™ãƒ«: <span id="speedDisplay" style="color:#00FF7F; font-weight:bold;">4</span></label>
            <br>
            <input type="range" id="speedSlider" min="1" max="10" value="4" oninput="updateSpeedLabel()">
            <div style="font-size: 12px; color: #aaa; margin-top:5px;">(1:åˆå¿ƒè€… ã€œ 10:ä¸Šç´šè€…)</div>
        </div>

        <div class="btn" onclick="startGame('mix')">ğŸ¸ å®Ÿæˆ¦ãƒãƒƒã‚¯é–‹å§‹</div>
        <div style="margin-top:20px; color:#ccc; font-size:12px;">ã‚¹ãƒãƒƒã‚·ãƒ¥ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—ãƒ»ãƒ˜ã‚¢ãƒ”ãƒ³ãŒ<br>ãƒ©ãƒ³ãƒ€ãƒ ã«æ¥ã¾ã™</div>
    </div>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <div id="ui-layer">
            <div class="hud">Score: <span id="scoreVal">0</span></div>
            <div class="hud">Time: <span id="timeVal">30</span></div>
        </div>
    </div>

    <div id="result-screen">
        <div id="result-msg">Time Up!</div>
        <div class="btn" onclick="backToMenu()">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const menuScreen = document.getElementById('menu-screen');
        const gameContainer = document.getElementById('game-container');
        const resultScreen = document.getElementById('result-screen');
        const scoreEl = document.getElementById('scoreVal');
        const timeEl = document.getElementById('timeVal');
        const speedSlider = document.getElementById('speedSlider'); 
        const speedDisplay = document.getElementById('speedDisplay'); 

        let width, height;
        let score = 0;
        let timeLeft = 30;
        let gameActive = false;
        let targets = [];
        let gameLoopId;
        let timerId;
        let currentSpeed = 4;
        let frameCount = 0;

        // ãƒªã‚µã‚¤ã‚ºï¼†ã‚³ãƒ¼ãƒˆæ¯”ç‡è¨­å®š
        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }
        window.addEventListener('resize', resize);
        resize();

        function updateSpeedLabel() {
            speedDisplay.innerText = speedSlider.value;
        }

        function startGame(mode) {
            currentSpeed = parseInt(speedSlider.value);
            menuScreen.style.display = 'none';
            resultScreen.style.display = 'none';
            gameContainer.style.display = 'block';
            
            score = 0;
            timeLeft = 30;
            frameCount = 0;
            scoreEl.innerText = score;
            timeEl.innerText = timeLeft;
            gameActive = true;
            targets = [];
            
            spawnShuttle(); // æœ€åˆã®1çƒ

            clearInterval(timerId);
            timerId = setInterval(() => {
                timeLeft--;
                timeEl.innerText = timeLeft;
                if (timeLeft <= 0) endGame();
            }, 1000);

            update();
        }

        function backToMenu() {
            resultScreen.style.display = 'none';
            gameContainer.style.display = 'none';
            menuScreen.style.display = 'flex';
        }

        function endGame() {
            gameActive = false;
            clearInterval(timerId);
            cancelAnimationFrame(gameLoopId);
            document.getElementById('result-msg').innerHTML = `Training Finish!<br>Hits: ${score}`;
            resultScreen.style.display = 'flex';
        }

        // â–  ã‚·ãƒ£ãƒˆãƒ«ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã“ã“ãŒãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³ä»•æ§˜ï¼‰
        function spawnShuttle() {
            // ã‚·ãƒ§ãƒƒãƒˆã®ç¨®é¡ã‚’ãƒ©ãƒ³ãƒ€ãƒ æ±ºå®š
            // 0:ã‚¹ãƒãƒƒã‚·ãƒ¥(é€Ÿã„/å¥¥), 1:ãƒ‰ãƒ­ãƒƒãƒ—(é…ã„/æ‰‹å‰), 2:ãƒ˜ã‚¢ãƒ”ãƒ³(è¶…é…ã„/ãƒãƒƒãƒˆéš›)
            const shotType = Math.floor(Math.random() * 3);
            
            const r = 20; // ã‚·ãƒ£ãƒˆãƒ«ã‚µã‚¤ã‚º
            // ç›¸æ‰‹ã‚³ãƒ¼ãƒˆï¼ˆç”»é¢ä¸Šéƒ¨ï¼‰ã®ã©ã“ã‹ã‹ã‚‰ç™ºå°„
            const startX = Math.random() * (width - r * 2) + r;
            const startY = -50; // ç”»é¢å¤–ã‹ã‚‰å‡ºç¾

            let speedBase = currentSpeed; 
            let targetY = 0; // åˆ°é”ç›®æ¨™åœ°ç‚¹(Y)
            let color = '#fff';

            if (shotType === 0) { // ã‚¹ãƒãƒƒã‚·ãƒ¥
                speedBase *= 1.8; // é€Ÿã„
                targetY = height * 0.8; // ã‚³ãƒ¼ãƒˆå¥¥ã¾ã§æ¥ã‚‹
                color = 'yellow'; // è¦–èªæ€§é«˜ã
            } else if (shotType === 1) { // ãƒ‰ãƒ­ãƒƒãƒ—
                speedBase *= 0.8; // å°‘ã—é…ã„
                targetY = height * 0.5; // çœŸã‚“ä¸­ã‚ãŸã‚Š
                color = 'white';
            } else { // ãƒ˜ã‚¢ãƒ”ãƒ³
                speedBase *= 0.5; // ã‚†ã£ãã‚Š
                targetY = height * 0.35; // ãƒãƒƒãƒˆéš›
                color = '#eee';
            }

            // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ
            targets.push({
                x: startX,
                y: startY,
                r: r,
                targetY: targetY, // ã©ã“ã¾ã§è½ã¡ã‚‹ã‹
                speed: speedBase * (height / 800), // ç”»é¢é«˜ã•ã«åˆã‚ã›ã¦é€Ÿåº¦èª¿æ•´
                type: shotType,
                color: color,
                alive: true
            });
        }

        // â–  ã‚³ãƒ¼ãƒˆæç”»
        function drawCourt() {
            ctx.strokeStyle = "white";
            ctx.lineWidth = 4;
            
            // ãƒãƒƒãƒˆï¼ˆç”»é¢ä¸Šéƒ¨1/3ã‚ãŸã‚Šã‚’ãƒãƒƒãƒˆã¨è¦‹ç«‹ã¦ã‚‹ï¼‰
            const netY = height * 0.3;
            ctx.beginPath();
            ctx.moveTo(0, netY);
            ctx.lineTo(width, netY);
            ctx.stroke();

            // ã‚µãƒ¼ãƒ“ã‚¹ãƒ©ã‚¤ãƒ³ï¼ˆæ‰‹å‰ï¼‰
            const serviceLineY = height * 0.85;
            ctx.beginPath();
            ctx.moveTo(0, serviceLineY);
            ctx.lineTo(width, serviceLineY);
            ctx.stroke();

            // ã‚»ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¤ãƒ³
            ctx.beginPath();
            ctx.moveTo(width / 2, netY);
            ctx.lineTo(width / 2, serviceLineY);
            ctx.stroke();
            
            // ãƒãƒƒãƒˆã®ç¶²ç›®è¡¨ç¾ï¼ˆè£…é£¾ï¼‰
            ctx.lineWidth = 1;
            ctx.strokeStyle = "rgba(255,255,255,0.3)";
            for(let i=0; i<width; i+=20) {
                ctx.beginPath(); ctx.moveTo(i, netY-10); ctx.lineTo(i, netY+10); ctx.stroke();
            }
        }

        function update() {
            if (!gameActive) return;
            
            // èƒŒæ™¯ï¼ˆã‚³ãƒ¼ãƒˆè‰²ï¼‰å¡—ã‚Šã¤ã¶ã—
            ctx.fillStyle = "#2E8B57"; 
            ctx.fillRect(0, 0, width, height);
            
            // ã‚³ãƒ¼ãƒˆç·šã‚’æç”»
            drawCourt();

            frameCount++;
            // ä¸€å®šé–“éš”ã§æ¬¡å¼¾ç™ºå°„ï¼ˆé›£æ˜“åº¦èª¿æ•´ï¼‰
            // ã‚¹ãƒ”ãƒ¼ãƒ‰ãŒé€Ÿã„ã»ã©ã€æ¬¡å¼¾ã®é–“éš”ã‚‚çŸ­ãã™ã‚‹
            let spawnRate = Math.max(30, 100 - (currentSpeed * 5));
            if (frameCount % spawnRate === 0) {
                spawnShuttle();
            }

            // ã‚·ãƒ£ãƒˆãƒ«ã®ç§»å‹•ã¨æç”»
            for (let i = targets.length - 1; i >= 0; i--) {
                const t = targets[i];
                
                // ä¸Šã‹ã‚‰ä¸‹ã¸ç§»å‹•
                t.y += t.speed;

                // æç”»ï¼ˆç°¡æ˜“çš„ãªã‚·ãƒ£ãƒˆãƒ«ã£ã½ã„å††ï¼‰
                ctx.beginPath();
                ctx.arc(t.x, t.y, t.r, 0, Math.PI * 2);
                ctx.fillStyle = t.color;
                ctx.fill();
                // ã‚·ãƒ£ãƒˆãƒ«ã®ç¾½éƒ¨åˆ†ï¼ˆè£…é£¾ï¼‰
                ctx.fillStyle = "rgba(255,255,255,0.5)";
                ctx.beginPath();
                ctx.arc(t.x, t.y - 10, t.r * 0.8, 0, Math.PI, true);
                ctx.fill();
                ctx.closePath();

                // ç”»é¢å¤–ï¼ˆä¸‹ï¼‰ã«å‡ºãŸã‚‰æ¶ˆã™ï¼ˆãƒŸã‚¹ï¼‰
                // æœ¬æ¥ã¯ã€Œã‚¿ãƒ¼ã‚²ãƒƒãƒˆYã€ã‚’è¶…ãˆãŸã‚‰æ¶ˆã™ãªã©èª¿æ•´å¯èƒ½
                if (t.y > height + 50) {
                    targets.splice(i, 1);
                }
            }

            gameLoopId = requestAnimationFrame(update);
        }

        // ã‚¿ãƒƒãƒåˆ¤å®š
        function handleInput(e) {
            if (!gameActive) return;
            e.preventDefault();
            const touches = e.changedTouches || [e]; 
            
            for (let i = 0; i < touches.length; i++) {
                const tx = touches[i].clientX;
                const ty = touches[i].clientY;

                for (let j = targets.length - 1; j >= 0; j--) {
                    const t = targets[j];
                    const dist = Math.hypot(t.x - tx, t.y - ty);
                    
                    if (dist < t.r + 30) { // åˆ¤å®šåºƒã‚
                        score++;
                        scoreEl.innerText = score;
                        targets.splice(j, 1); // ãƒ’ãƒƒãƒˆã—ãŸã‚‰æ¶ˆãˆã‚‹
                        
                        // ãƒ’ãƒƒãƒˆã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆé»„è‰²ã„æ³¢ç´‹ï¼‰
                        createHitEffect(tx, ty);
                        break;
                    }
                }
            }
        }
        
        function createHitEffect(x, y) {
            // ç°¡æ˜“ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆä»Šå›ã¯æç”»å‡¦ç†ã«å…¥ã‚Œè¾¼ã‚€ã®ãŒè¤‡é›‘ã«ãªã‚‹ã®ã§ã‚¹ã‚­ãƒƒãƒ—å¯ã ãŒã€ãƒ­ã‚°ã«ã¯æ®‹ã™ï¼‰
            // console.log("Hit!");
        }

        window.addEventListener('mousedown', handleInput);
        window.addEventListener('touchstart', handleInput, {passive: false});

    </script>
</body>
</html>