<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å‹•ä½“è¦–åŠ›ãƒˆãƒ¬ V7 (Real Badminton)</title>
    <style>
        body {
            margin: 0; overflow: hidden;
            /* ãƒªã‚¢ãƒ«ãªã‚³ãƒ¼ãƒˆã®é›°å›²æ°—ã‚’CSSã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§è¡¨ç¾ */
            background: linear-gradient(to bottom, #8B4513 0%, #8B4513 10%, #006400 10%, #006400 90%, #8B4513 90%, #8B4513 100%);
            font-family: sans-serif; color: white; touch-action: none;
        }
        #game-container { display: none; width: 100%; height: 100%; }
        canvas { display: block; }
        
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; padding: 20px; box-sizing: border-box;
            display: flex; justify-content: space-between;
        }
        .hud { font-size: 18px; font-weight: bold; text-shadow: 1px 1px 2px black; }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ */
        #menu-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.9); display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 100;
        }
        h1 { margin-bottom: 10px; font-size: 24px; text-align: center; color: #fff; }
        
        .btn {
            width: 80%; max-width: 300px; padding: 15px; margin: 8px;
            font-size: 18px; font-weight: bold; color: #333;
            background-color: #fff; border: 3px solid #fff;
            border-radius: 30px; cursor: pointer; text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .btn:active { transform: scale(0.95); background-color: #ddd; }
        
        /* è¨­å®šã‚¨ãƒªã‚¢ */
        .setting-box {
            width: 80%; max-width: 300px;
            background-color: #444; padding: 15px; margin: 15px 0;
            border-radius: 10px; text-align: center; color: white;
        }
        input[type=range] { width: 100%; margin-top: 10px; accent-color: #00FF7F; }
        
        /* ãƒªã‚¶ãƒ«ãƒˆç”»é¢ï¼ˆè¨ºæ–­çµæœè¡¨ç¤ºç”¨ï¼‰ */
        #result-screen {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.9); flex-direction: column;
            align-items: center; justify-content: center; z-index: 50; color: white;
        }
        #result-title { font-size: 24px; margin-bottom: 10px; }
        #result-score { font-size: 48px; font-weight: bold; color: #00FF7F; margin-bottom: 20px; }
        #result-level { font-size: 28px; font-weight: bold; color: yellow; margin-bottom: 30px; text-align: center;}
    </style>
</head>
<body>

    <div id="menu-screen">
        <h1>Badminton Trainer<br>V7 Real</h1>
        
        <div class="setting-box">
            <label>çƒé€Ÿãƒ¬ãƒ™ãƒ«: <span id="speedDisplay" style="color:#00FF7F; font-weight:bold;">4</span></label>
            <br>
            <input type="range" id="speedSlider" min="1" max="10" value="4" oninput="updateSpeedLabel()">
            <div style="font-size: 12px; color: #aaa; margin-top:5px;">(ãƒ¬ãƒ™ãƒ«ãŒé«˜ã„ã»ã©è¨ºæ–­çµæœUP!)</div>
        </div>

        <div class="btn" onclick="startGame()">ğŸ¸ å®Ÿæˆ¦è¨ºæ–­ã‚¹ã‚¿ãƒ¼ãƒˆ</div>
        <div style="margin-top:20px; color:#ccc; font-size:12px;">å¥¥ã‹ã‚‰æ‰‹å‰ã«é£›ã‚“ã§ãã‚‹<br>ã‚·ãƒ£ãƒˆãƒ«ã‚’ã‚¿ãƒƒãƒ—ï¼</div>
    </div>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <div id="ui-layer">
            <div class="hud">Hits: <span id="scoreVal">0</span></div>
            <div class="hud">Time: <span id="timeVal">30</span></div>
        </div>
    </div>

    <div id="result-screen">
        <div id="result-title">è¨ºæ–­çµæœ</div>
        <div>ãƒ’ãƒƒãƒˆæ•°: <span id="result-score">0</span> å›</div>
        <div id="result-level">åˆ¤å®šä¸­...</div>
        <div class="btn" onclick="backToMenu()">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const menuScreen = document.getElementById('menu-screen');
        const gameContainer = document.getElementById('game-container');
        const resultScreen = document.getElementById('result-screen');
        const scoreEl = document.getElementById('scoreVal');
        const timeEl = document.getElementById('timeVal');
        const speedSlider = document.getElementById('speedSlider'); 
        const speedDisplay = document.getElementById('speedDisplay'); 
        const resultScoreEl = document.getElementById('result-score');
        const resultLevelEl = document.getElementById('result-level');

        let width, height, courtTop, courtBottom;
        let score = 0;
        let timeLeft = 30;
        let gameActive = false;
        let targets = [];
        let gameLoopId;
        let timerId;
        let currentSpeed = 4;
        let frameCount = 0;
        const baseShuttleSize = 25; // ã‚·ãƒ£ãƒˆãƒ«ã®åŸºæº–ã‚µã‚¤ã‚º

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            // ã‚³ãƒ¼ãƒˆã®æç”»é ˜åŸŸï¼ˆCSSã®èƒŒæ™¯ã«åˆã‚ã›ã‚‹ï¼‰
            courtTop = height * 0.1;
            courtBottom = height * 0.9;
        }
        window.addEventListener('resize', resize);
        resize();

        function updateSpeedLabel() {
            speedDisplay.innerText = speedSlider.value;
        }

        function startGame() {
            currentSpeed = parseInt(speedSlider.value);
            menuScreen.style.display = 'none';
            resultScreen.style.display = 'none';
            gameContainer.style.display = 'block';
            
            score = 0;
            timeLeft = 30;
            frameCount = 0;
            scoreEl.innerText = score;
            timeEl.innerText = timeLeft;
            gameActive = true;
            targets = [];
            
            spawnShuttle(); 

            clearInterval(timerId);
            timerId = setInterval(() => {
                timeLeft--;
                timeEl.innerText = timeLeft;
                if (timeLeft <= 0) endGame();
            }, 1000);

            update();
        }

        function backToMenu() {
            resultScreen.style.display = 'none';
            gameContainer.style.display = 'none';
            menuScreen.style.display = 'flex';
        }

        // â–  ã‚²ãƒ¼ãƒ çµ‚äº†ï¼†è¨ºæ–­ãƒ­ã‚¸ãƒƒã‚¯
        function endGame() {
            gameActive = false;
            clearInterval(timerId);
            cancelAnimationFrame(gameLoopId);
            
            resultScoreEl.innerText = score;
            
            // â˜… å‹•ä½“è¦–åŠ›ãƒ¬ãƒ™ãƒ«è¨ºæ–­ â˜…
            // ã‚¹ãƒ”ãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã¨ãƒ’ãƒƒãƒˆæ•°ã‚’æ›ã‘åˆã‚ã›ã¦ã‚¹ã‚³ã‚¢åŒ–
            const diagnosticScore = score * currentSpeed;
            let levelMsg = "";
            let levelColor = "white";

            if (diagnosticScore >= 250) {
                levelMsg = "ç¥ã®ç›®ï¼<br>ã‚¢ã‚¹ãƒªãƒ¼ãƒˆç´š";
                levelColor = "#FFD700"; // Gold
            } else if (diagnosticScore >= 180) {
                levelMsg = "ã™ã”ã„ï¼<br>ä¸Šç´šè€…ãƒ¬ãƒ™ãƒ«";
                levelColor = "#00FF7F"; // SpringGreen
            } else if (diagnosticScore >= 100) {
                levelMsg = "ãƒŠã‚¤ã‚¹ï¼<br>ä¸­ç´šè€…ãƒ¬ãƒ™ãƒ«";
                levelColor = "cyan";
            } else if (diagnosticScore >= 50) {
                levelMsg = "ã¾ãšã¾ãš<br>åˆç´šè€…ãƒ¬ãƒ™ãƒ«";
                levelColor = "white";
            } else {
                levelMsg = "ã‚‚ã£ã¨é›ãˆã‚ˆã†ï¼<br>ãƒ“ã‚®ãƒŠãƒ¼ãƒ¬ãƒ™ãƒ«";
                levelColor = "#ccc";
            }
            
            resultLevelEl.innerHTML = levelMsg;
            resultLevelEl.style.color = levelColor;
            resultScreen.style.display = 'flex';
        }

        function spawnShuttle() {
            const shotType = Math.floor(Math.random() * 3);
            const startX = Math.random() * (width - baseShuttleSize*2) + baseShuttleSize;
            const startY = courtTop - 50; // ã‚³ãƒ¼ãƒˆå¥¥ã®ç”»é¢å¤–ã‹ã‚‰

            let speedBase = currentSpeed; 
            let targetY = 0; 

            if (shotType === 0) { // ã‚¹ãƒãƒƒã‚·ãƒ¥
                speedBase *= 1.8; 
                targetY = courtBottom * 0.9; // ã‚³ãƒ¼ãƒˆå¥¥æ·±ãã¾ã§
            } else if (shotType === 1) { // ãƒ‰ãƒ­ãƒƒãƒ—
                speedBase *= 0.8; 
                targetY = (courtTop + courtBottom) / 2; // ã‚³ãƒ¼ãƒˆä¸­å¤®
            } else { // ãƒ˜ã‚¢ãƒ”ãƒ³
                speedBase *= 0.5; 
                targetY = courtTop + (courtBottom - courtTop) * 0.2; // ãƒãƒƒãƒˆéš›
            }

            targets.push({
                x: startX,
                y: startY,
                baseR: baseShuttleSize,
                currentR: baseShuttleSize * 0.5, // æœ€åˆã¯å°ã•ã
                targetY: targetY,
                speed: speedBase * (height / 800),
                type: shotType
            });
        }

        // â–  ãƒªã‚¢ãƒ«ãªã‚³ãƒ¼ãƒˆæç”»
        function drawCourt() {
            ctx.strokeStyle = "white";
            ctx.lineWidth = 3;
            
            // ãƒãƒƒãƒˆä½ç½®
            const netY = courtTop + (courtBottom - courtTop) * 0.3;
            // ã‚µãƒ¼ãƒ“ã‚¹ãƒ©ã‚¤ãƒ³ä½ç½®
            const serviceLineY = courtTop + (courtBottom - courtTop) * 0.85;

            // å¤–æ 
            ctx.strokeRect(10, courtTop, width-20, courtBottom - courtTop);

            // ãƒãƒƒãƒˆ
            ctx.beginPath(); ctx.moveTo(10, netY); ctx.lineTo(width-10, netY); ctx.stroke();
            // ã‚µãƒ¼ãƒ“ã‚¹ãƒ©ã‚¤ãƒ³
            ctx.beginPath(); ctx.moveTo(10, serviceLineY); ctx.lineTo(width-10, serviceLineY); ctx.stroke();
            // ã‚»ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¤ãƒ³
            ctx.beginPath(); ctx.moveTo(width/2, netY); ctx.lineTo(width/2, serviceLineY); ctx.stroke();
            
            // ãƒãƒƒãƒˆã®ç¶²ç›®
            ctx.lineWidth = 1; ctx.strokeStyle = "rgba(255,255,255,0.4)";
            for(let i=10; i<width-10; i+=15) {
                ctx.beginPath(); ctx.moveTo(i, netY-8); ctx.lineTo(i, netY+8); ctx.stroke();
            }
        }

        // â–  ãƒªã‚¢ãƒ«ãªã‚·ãƒ£ãƒˆãƒ«æç”»ï¼ˆãƒ†ãƒ‹ã‚¹ãƒœãƒ¼ãƒ«å’æ¥­ï¼ï¼‰
        function drawShuttle(x, y, r) {
            ctx.save();
            ctx.translate(x, y);
            // ã‚·ãƒ£ãƒˆãƒ«ã®å‘ãï¼ˆå¸¸ã«ä¸‹å‘ãï¼‰
            ctx.rotate(Math.PI); 

            // ç¾½æ ¹éƒ¨åˆ†ï¼ˆæ‰‡å½¢ï¼‰
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.arc(0, 0, r * 1.8, -Math.PI / 6, Math.PI / 6);
            ctx.closePath();
            ctx.fillStyle = "rgba(255, 255, 255, 0.9)";
            ctx.fill();
            // ç¾½æ ¹ã®è»¸ï¼ˆç·šï¼‰
            ctx.strokeStyle = "#ddd"; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(r*1.6, 0); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(r*1.5, r*0.5); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(r*1.5, -r*0.5); ctx.stroke();

            // ã‚³ãƒ«ã‚¯éƒ¨åˆ†ï¼ˆåŠå††ï¼‰
            ctx.beginPath();
            ctx.arc(0, 0, r * 0.6, 0, Math.PI * 2);
            ctx.fillStyle = "#FFD700"; // ã‚³ãƒ«ã‚¯è‰²
            ctx.fill();
            ctx.strokeStyle = "#DAA520"; ctx.lineWidth = 2; ctx.stroke();

            ctx.restore();
        }

        function update() {
            if (!gameActive) return;
            ctx.clearRect(0, 0, width, height);
            drawCourt();
            frameCount++;

            let spawnRate = Math.max(20, 90 - (currentSpeed * 6));
            if (frameCount % spawnRate === 0) spawnShuttle();

            for (let i = targets.length - 1; i >= 0; i--) {
                const t = targets[i];
                t.y += t.speed;

                // â˜… é«˜ã•ï¼ˆé è¿‘ï¼‰ã®è¨ˆç®— â˜…
                // ç”»é¢ä¸Šéƒ¨(courtTop)ã«ã„ã‚‹ã¨ãã¯0.5å€ã€ä¸‹éƒ¨(courtBottom)ã«æ¥ã‚‹ã¨1.5å€ã®å¤§ãã•ã«ãªã‚‹
                const progress = (t.y - courtTop) / (courtBottom - courtTop);
                const scale = 0.5 + Math.max(0, Math.min(1, progress)) * 1.0;
                t.currentR = t.baseR * scale;

                // ãƒªã‚¢ãƒ«ã‚·ãƒ£ãƒˆãƒ«æç”»é–¢æ•°ã‚’å‘¼ã³å‡ºã™
                drawShuttle(t.x, t.y, t.currentR);

                if (t.y > height + 100) targets.splice(i, 1);
            }
            gameLoopId = requestAnimationFrame(update);
        }

        function handleInput(e) {
            if (!gameActive) return;
            e.preventDefault();
            const touches = e.changedTouches || [e]; 
            for (let i = 0; i < touches.length; i++) {
                const tx = touches[i].clientX;
                const ty = touches[i].clientY;
                for (let j = targets.length - 1; j >= 0; j--) {
                    const t = targets[j];
                    // åˆ¤å®šã‚‚è¦‹ãŸç›®ã®å¤§ãã•ã«åˆã‚ã›ã‚‹
                    const dist = Math.hypot(t.x - tx, t.y - ty);
                    if (dist < t.currentR + 30) { 
                        score++;
                        scoreEl.innerText = score;
                        targets.splice(j, 1);
                        break;
                    }
                }
            }
        }
        window.addEventListener('mousedown', handleInput);
        window.addEventListener('touchstart', handleInput, {passive: false});
    </script>
</body>
</html>